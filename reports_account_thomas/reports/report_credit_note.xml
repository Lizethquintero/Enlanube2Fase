<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
    <report
                id="report_custom_account_credit_note"
                string="Nota crédito"
                model="account.move"
                report_type="qweb-pdf"
                name="reports_account_thomas.report_custom_template_account_credit_note"
        />

        <record id="paperformat_low_monthly_report_account_credit_note" model="report.paperformat">
          <field name="name">Formato de papel nota credito</field>
          <field name="default" eval="True"/>
          <field name="format">A4</field>
          <field name="page_height">0</field>
          <field name="page_width">0</field>
          <field name="orientation">Portrait</field>
          <field name="margin_top">13</field>
          <field name="margin_bottom">25</field>
          <field name="margin_left">13</field>
          <field name="margin_right">13</field>
          <field name="header_line" eval="False"/>
          <field name="header_spacing">3</field>
          <field name="dpi">90</field>
        </record>

        <template id="report_custom_template_account_credit_note">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">                    
                    <div class="header">
						<div class="container-fluid" id="main-content">
                            <div class="container">
                                <div class="row">
                                    <div class="col-2">
                                        <img t-att-src="'data:image/png;base64,%s' % to_text(o.company_id.logo)" width="150" height="60"/>
                                    </div>
                                    <div class="col-10" style="text-align: center;">
                                        <span t-field="o.company_id.partner_id.name"></span> <br />
                                        <span t-field="o.company_id.partner_id.identification_document"></span> <br />
                                        <span t-field="o.company_id.phone"></span> <br />
                                        <span t-field="o.company_id.street"></span>  
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <p align="right">
                                 <span>Pagina</span>
                                <span class="page"/>
                                <span> de </span>
                                <span class="topage"/>
                            </p>
                        </div>

                    </div>
                    <div class="article o_report_layout_standard">
                    <div class="page">
                        <style>
                            th, td {
									padding: 0px;
									font-size: 10pt;                                    
                                    border: 1px solid #000;
                            }
							   							   							  
                            table{
                                width: 100%;
                                border: 1px solid #000;
                                border-spacing: 0px;
                            }
							   
							th{
								text-align: center;
							}
							.container{
								margin: 0px;
								padding: 0px;
							}
							td{
								padding: 0px 5px;
							} 
                            
                        </style>        
                            <br />
                        <table width="100%">
                            <tr>
                                <th style="background-color:#CBCBCB; text-align:center; vertical-align: middle;">DATOS DEL TERCERO</th>
	                            <th style="background-color:#CBCBCB; text-align:center; vertical-align: middle;" colspan="2">Documento contable</th>
	                        </tr>
	                        <tr>
                            <td valign="middle" align="left" style="padding-left: 5px;">
                                Razón Social o Nombre: <span style="margin-left: 20px;" t-field="o.partner_id.name" /><br />
                                NIT: <span style="margin-left: 130px;" t-field="o.partner_id.identification_document" /> <br />
                                Dirección: <span style="margin-left: 95px;" t-field="o.partner_id.complete_adress_dian" /> <br />
                                Ciudad: <span style="margin-left: 110px;" t-field="o.partner_id.city_id" /> <br />
                                Télefono: <span style="margin-left: 100px;" t-field="o.partner_id.phone" />  
	                        </td>
	                        <td colspan="2" style="vertical-align: middle;">
								<p style="text-align: center; font-weight: bold; font-size: 20pt;">
									<span t-field="o.name" />
								</p>
							</td>
	                        </tr>	                                            
                            <tr>
                                <th style="background-color:#CBCBCB; text-align: center;"><strong>DATOS DEL PAGO</strong></th>
                                <th style="background-color:#CBCBCB; text-align: center;"><strong>FECHA CONTABLE</strong></th>
                                <th style="background-color:#CBCBCB; text-align: center;"><strong>FECHA DOCUMENTO</strong></th>
                            </tr>
                            <tr>
                                <td rowspan="3" valign="middle" align="left" style="padding-left: 5px;" width="65%">    										
									<div class="container">
										<div class="row">
											<div class="col-4">
												Concepto: <br />
												Metodo de pago: <br />
												Moneda: <br />
												Tasa de Cambio:													
											</div>
											<div class="col-8">
												<br />
												<span t-field="o.payment_mean_id" /> <br />
												<span t-field="o.currency_id" /> <br />
												<span t-field="o.currency_rate_raw" />										
											</div>
										</div>
									</div>
                                </td>                                
                                <td style="text-align: center;"><span t-field="o.date" /></td> 
                                <td style="text-align: center;"><span t-esc="o.invoice_date"/>  </td>
                            </tr>
                            <tr>
                                <th style="background-color:#CBCBCB; text-align: center; font-weight: bold;" colspan="2">REFERENCIA/FACTURA</th>
                            </tr>
                            <tr>
                                <td style="text-align: center;" colspan="2"><span t-field="o.ref" /></td>
                            </tr>
                        </table> 
                            
                        <table width="100%" border="1" cellpadding="0" cellspacing="0" bordercolor="#000000">
                            <tr>
                                <th colspan="6" valign="middle" style="background-color:#CBCBCB; text-align: center;"><strong>POSICIONES DOCUMENTO
                                        CONTABLE</strong></th>
                            </tr>
                            <tr>
                                <th style="text-align: center; background-color: #eeeeee;"><strong>CUENTA</strong></th>
                                <th style="text-align: center; background-color: #eeeeee;"><strong>DESCRIPCION</strong></th>
                                <th style="text-align: center; background-color: #eeeeee;"><strong>NIT</strong></th>
                                <th style="text-align: center; background-color: #eeeeee;"><strong>ORD/CECO</strong></th>
                                <th style="text-align: center; background-color: #eeeeee;"><strong>IMP. MON DOC</strong></th>
                                <th style="text-align: center; background-color: #eeeeee;"><strong>IMP. MON LOC</strong></th>
                            </tr>
							<t t-foreach="o.line_ids" t-as="i">							
								<tr>
									<td><span t-field="i.account_id.code" /></td>
									<td><span t-field="i.name" /></td>
									<td><span t-field="i.partner_id.identification_document" /></td>
									<td><span t-field="i.analytic_account_id.code" /></td>                            
									<td><span t-field="i.amount_currency" /></td>
									<td><span t-field="i.credit" /></td>
								</tr>
							</t>
                        </table>
                        
                        <br /><br />
                        
                        <table width="100%" border="1" cellpadding="0" cellspacing="0" bordercolor="#000000">
                            <tr>
                                <th style="text-align: center; background-color: #CBCBCB;" colspan="4">RETENCIONES PRACTICADAS</th>
                            </tr>
                            <tr>
                                <th style="text-align: center; font-weight: bold; background-color: #CBCBCB;">DESCRIPCIÓN</th>
                                <th style="text-align: center; font-weight: bold; background-color: #CBCBCB;">%</th>
                                <th style="text-align: center; font-weight: bold; background-color: #CBCBCB;">BASEe</th>
                                <th style="text-align: center; font-weight: bold; background-color: #CBCBCB;">Vr. RETENIDO</th>
                            </tr>
							<t t-set="total" t-value="0" />
							<t t-foreach="o.invoice_line_ids" t-as="i">
								<t t-foreach="i.tax_ids" t-as="j">									
									<t t-set="retained" t-value="(i.price_subtotal * j.amount) / 100"/>
									<t t-set="total" t-value="total + retained" />
                                    <tr>
                                        <td><span t-field="j.name" /></td>
                                        <td style="text-align: center;"><span t-field="j.amount" /></td>
                                        <td style="text-align: right;"><span t-field="i.price_subtotal" /></td> 
                                        <td style="text-align: right;"><t t-esc="retained" />  </td>                           
                                        
                                    </tr>
                                </t>
							</t> 
							
                            <tr>
                                <td style="border: none;"></td>
                                <td style="border: none;"></td>
                                <td style="text-align: right; font-weight: bold; border: none; border-right: 1px solid;">Total Retenido</td>
                                <td style="text-align: right; border: none;"><span t-esc="total" /></td>
                            </tr>                            
                        </table>
                        
                    </div>
                    
                    </div>
                    <div class="footer">
                        <style>                            
                            table{
                                width: 100%;
                                border: 1px solid #000;
                                cellpadding: 0;
                                cellspacing :0;
                                    
                            }
                        </style>
                        <table>
                            <tr>
                                <td align="center" style="padding-top: 40px;">
                                    <hr width="90%" color="black" style="padding: 0; margin-bottom: 0;" />
                                    Elaboro: <span style="text-align: center;" t-field="o.create_uid" />
                                </td>
                                <td align="center" style="padding-top: 40px;">
                                    <hr width="90%" color="black" style="padding: 0; margin-bottom: 0;" />
                                    <span style="text-align: center;">Autorizado por</span>
                                </td>

                                <td align="center" style="padding-top: 40px;">
                                    <hr width="90%" color="black" style="padding: 0; margin-bottom: 0;" />
                                    VoBo. Tesorería
                                </td>
                                <td align="center" style="padding-top: 40px;">
                                    <hr width="90%" color="black" style="padding: 0; margin-bottom: 0;" />
                                    Recibí conforme
                                </td>
                            </tr>
                        </table>
                        Imprimió: <span t-field="user.name" />  <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%d.%m.%Y %H:%M:%S')" />
                    </div>
                </t>
            </t>
    
        </template>
    </data>
</odoo>
